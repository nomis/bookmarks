<%
# SPDX-FileCopyrightText: 2021 Simon Arlott
# SPDX-License-Identifier: AGPL-3.0-or-later
%>
<header>
<nav>
<% if user_signed_in? %>
<ul class="main menu">
	<li><%= link_to "New", new_bookmark_path, rel: "nofollow" %></li>
	<li><%= link_to "Bookmarklet", bookmarklet_uri, title: "Bookmarklet to create a new bookmark", rel: "nofollow", class: "bookmarklet" %></li>
</ul>
<ul class="user menu">
	<li><%= link_to "Edit user", edit_user_registration_path, rel: "nofollow" %></li>
	<li><%= link_to "Logout", destroy_user_session_path(request_forgery_protection_token => form_authenticity_token), rel: "nofollow" %></li>
</ul>
<% else %>
<ul class="user menu">
	<li><%= link_to "Login", new_user_session_path, rel: "nofollow" %></li>
</ul>
<% end %>
</nav>
<% unless list.tags.empty? %>
<h2>Tags</h2>
<ul class="tags">
	<% list.tags.each do |t| %>
		<%= tag.li(class: t.search_match? ? "matching" : nil) do %>
			<% if t.search_match? %>
				<%= tag.strong do %><%= link_to_search_by_tags(t) %><% end %>
			<% else %>
				<%= link_to_search_by_tags(t) %>
			<% end %>
			<span class="count"><span class="alt_text">(</span><%= t.count %><span class="alt_text">)</span></span>
		<% end %>
	<% end %>
</ul>
<% end %>
</header>
<main>
<h2>Bookmarks</h2>
<ol class="bookmarks" start="<%= list.pagination.offset %>">
	<% list.bookmarks.each do |bookmark| %>
	<li>
		<%= link_to bookmark.title, bookmark.uri %><%
			uri = URI.parse(bookmark.uri)
			if uri.host
				%> (<%= uri.host %>)<%
			end
		%>
		<dl>
			<dt><span class="alt_text"><%= Bookmark.human_attribute_name(:tags) %>:</span></dt>
			<dd>
				<ul class="item_tags">
					<% bookmark.tags.each do |tag| %>
						<% if tag.search_match? %><strong><% end %>
						<li><%= link_to_search_by_tags(tag) %></li>
						<% if tag.search_match? %></strong><% end %>
					<% end %>
				</ul>
			</dd>
			<dt><span class="alt_text">Created:</span></dt>
			<dd><%= bookmark.created_at %></dd>
			<% if user_signed_in? %>
			<dt><span class="alt_text">Actions:</span></dt>
			<dd>
				<ul class="item menu">
					<li><%= link_to "Edit", edit_bookmark_path(bookmark), rel: "nofollow" %></li>
					<li><%= link_to "Delete", delete_bookmark_path(bookmark, request_forgery_protection_token => form_authenticity_token), rel: "nofollow", data: { confirm: "Are you sure?" } %></li>
				</ul>
			</dd>
			<% end %>
		</dl>
	</li>
	<% end %>
</ol>
</main>
<footer>
<% if list.pagination.pages > 1 %>
<%== pagination_nav(list.pagination) %>
<% end %>
</footer>
