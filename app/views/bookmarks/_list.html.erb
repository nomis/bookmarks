<%
# SPDX-FileCopyrightText: 2021 Simon Arlott
# SPDX-License-Identifier: AGPL-3.0-or-later
%>
<header>
<nav>
<ul class="main menu">
<% if user_signed_in? %>
	<li><%= link_to "New", new_bookmark_path, rel: "nofollow", class: "new" %></li>
	<li><%= link_to "ðŸ”–", bookmarklet_uri, title: "Bookmarklet to create a new bookmark", rel: "nofollow", class: "bookmarklet" %></li>
<% end %>
	<li><a href="#main" class="skip">Skip to content</a></li>
<% if user_signed_in? %>
	<li><%= link_to "Edit user", edit_user_registration_path, rel: "nofollow", class: "account" %></li>
	<li><%= link_to "Logout", destroy_user_session_path(request_forgery_protection_token => form_authenticity_token), rel: "nofollow", class: "logout" %></li>
<% else %>
	<li><%= link_to "Login", new_user_session_path, rel: "nofollow", class: "login" %></li>
<% end %>
</ul>
</nav>
<% unless list.tags.empty? %>
<h2>Tags</h2>
<ul class="main tags">
	<% list.tags.each do |t| %>
		<%= tag.li(class: t.search_match? ? "matching" : nil) do
			%><% if t.search_match? %><strong><% end
			%><%= link_to_search_by_tags(t) do
				%><span class="name"><%= t.name %></span>&nbsp;<span class="count"><span class="no_css">(</span><%= t.count %><span class="no_css">)</span></span><%
			end
			%><% if t.search_match? %></strong><% end
		end %>
	<% end %>
</ul>
<% end %>
</header>
<main id="main">
<h2>Bookmarks</h2>
<ol class="bookmarks" start="<%= list.pagination.offset + 1 %>">
	<% list.bookmarks.each do |bookmark| %>
	<li>
		<%= link_to bookmark.title, bookmark.uri, class: "bookmark" %><%
			uri = URI.parse(bookmark.uri)
			if uri.host
				%> (<%= uri.host %>)<%
			end
			if bookmark.private?
				%> <span title="Private">ðŸ”’</span><%
			end
		%>
		<dl>
			<dt class="no_css"><%= Bookmark.human_attribute_name(:tags) %>:</dt>
			<% if bookmark.tags.present? %>
				<dd class="item tags">
					<ul class="item tags">
						<% bookmark.tags.each do |t| %>
							<%= tag.li(class: t.search_match? ? "matching" : nil) do
								%><% if t.search_match? %><strong><% end
								%><%= link_to_search_by_tags(t)
								%><% if t.search_match? %></strong><% end
							end %>
						<% end %>
					</ul>
				</dd>
			<% end %>
			<% if user_signed_in? %>
			<dt class="no_css">Actions:</dt>
			<dd class="item menu">
				<ul class="item menu">
					<li><%= link_to edit_bookmark_path(bookmark), rel: "nofollow", title: "Edit", class: "icon edit" do %><span>Edit</span><% end %></li>
					<li><%= link_to delete_bookmark_path(bookmark, request_forgery_protection_token => form_authenticity_token), rel: "nofollow", title: "Delete", class: "icon delete", data: { confirm: "Are you sure?" } do %><span>Delete</span><% end %></li>
				</ul>
			</dd>
			<% end %>
		</dl>
	</li>
	<% end %>
</ol>
</main>
<footer>
<%== pagination_nav(list.pagination) if list.pagination.pages > 1 %>
</footer>
